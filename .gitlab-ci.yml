stages:
    - xavier-nx-industrial-16g
    - xavier-nx-industrial-8g
    - xavier-nx-devkit-16g
    - xavier-nx-devkit-8g
    - orin-nx-industrial-8g
    - orin-nx-reserver-8g
    - orin-nx-devkit-8g
    - orin-nx-industrial-16g
    - orin-nx-reserver-16g
    - orin-nx-devkit-16g
    - orin-nano-industrial-8g
    - orin-nano-reserver-8g
    - orin-nano-devkit-8g
    - orin-nano-industrial-4g
    - orin-nano-reserver-4g
    - orin-nano-devkit-4g


job-xavier-nx-industrial-16g:
    stage: xavier-nx-industrial-16g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root


    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t194/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0001 FAB=301  BOARDREV=F.0 ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-industrial external
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-xavier-nx-industrial.tar.gz  deploy/test/mfi_recomputer-xavier-nx-16g-industrial-$DATE_STR.tar.gz 
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0001 FAB=301  BOARDREV=B.0 ./tools/kernel_flash/l4t_initrd_flash.sh  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-industrial  external
         - cp  mfi_recomputer-xavier-nx-industrial.tar.gz  deploy/test/mfi_recomputer-xavier-nx-16g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy


job-xavier-nx-industrial-8g:
    stage: xavier-nx-industrial-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-xavier-nx-industrial-16g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t194/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0003 FAB=301  BOARDREV=F.0 ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-industrial external
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-xavier-nx-industrial.tar.gz  deploy/test/mfi_recomputer-xavier-nx-8g-industrial-$DATE_STR.tar.gz 
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0003 FAB=301  BOARDREV=B.0 ./tools/kernel_flash/l4t_initrd_flash.sh  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-industrial  external
         - cp  mfi_recomputer-xavier-nx-industrial.tar.gz  deploy/test/mfi_recomputer-xavier-nx-8g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy


job-xavier-nx-devkit-16g:
    stage: xavier-nx-devkit-16g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-xavier-nx-industrial-8g]

    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t194/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0001 FAB=301  BOARDREV=F.0 ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-devkit external
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-xavier-nx-devkit.tar.gz  deploy/test/mfi_recomputer-xavier-nx-16g-devkit-$DATE_STR.tar.gz 
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0001 FAB=301  BOARDREV=B.0 ./tools/kernel_flash/l4t_initrd_flash.sh  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-devkit  external
         - cp  mfi_recomputer-xavier-nx-devkit.tar.gz  deploy/test/mfi_recomputer-xavier-nx-16g-devkit-qspiflash-$DATE_STR.tar.gz 
         - umount deploy


job-xavier-nx-devkit-8g:
    stage: xavier-nx-devkit-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-xavier-nx-devkit-16g]

    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t194/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0003 FAB=301  BOARDREV=F.0 ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-devkit external
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-xavier-nx-devkit.tar.gz  deploy/test/mfi_recomputer-xavier-nx-8g-devkit-$DATE_STR.tar.gz 
         - ADDITIONAL_DTB_OVERLAY_OPT="BootOrderNvme.dtbo"  BOARDID=3668 BOARDSKU=0003 FAB=301  BOARDREV=B.0 ./tools/kernel_flash/l4t_initrd_flash.sh  -p "-c bootloader/t186ref/cfg/flash_l4t_t194_qspi_p3668.xml --no-systemimg"   --no-flash  --massflash 5 --network usb0 recomputer-xavier-nx-devkit  external
         - cp  mfi_recomputer-xavier-nx-devkit.tar.gz  deploy/test/mfi_recomputer-xavier-nx-8g-devkit-$DATE_STR.tar.gz 
         - umount deploy



job-orin-nx-industrial-8g:
    stage: orin-nx-industrial-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-xavier-nx-devkit-8g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nx-8g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nx-8g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nx-reserver-8g:
    stage: orin-nx-reserver-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-industrial-8g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nx-8g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial external 
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nx-8g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nx-devkit-8g:
    stage: orin-nx-devkit-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-reserver-8g]


    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recomputer-orin  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nx-8g-devkit-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0001 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin external 
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nx-8g-devkit-qspiflash-$DATE_STR.tar.gz 
         - umount deploy



job-orin-nx-industrial-16g:
    stage: orin-nx-industrial-16g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-devkit-8g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nx-16g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nx-16g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nx-reserver-16g:
    stage: orin-nx-reserver-16g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-industrial-16g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nx-16g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial external 
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nx-16g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nx-devkit-16g:
    stage: orin-nx-devkit-16g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-reserver-16g]


    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=G.0  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recomputer-orin  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nx-16g-devkit-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0000 FAB=300  BOARDREV=M.3  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin external 
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nx-16g-devkit-qspiflash-$DATE_STR.tar.gz 
         - umount deploy



job-orin-nano-industrial-8g:
    stage: orin-nano-industrial-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nx-devkit-16g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nano-8g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nano-8g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nano-reserver-8g:
    stage: orin-nano-reserver-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nano-industrial-8g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6   ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nano-8g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6   ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial external 
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nano-8g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nano-devkit-8g:
    stage: orin-nano-devkit-8g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nano-reserver-8g]


    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6   ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recomputer-orin  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nano-8g-devkit-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0003 FAB=RC1  BOARDREV=B.6   ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin external 
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nano-8g-devkit-qspiflash-$DATE_STR.tar.gz 
         - umount deploy


job-orin-nano-industrial-4g:
    stage: orin-nano-industrial-4g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nano-devkit-8g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2  ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nano-4g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2  ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin-industrial external 
         - cp  mfi_recompter-orin-industrial.tar.gz  deploy/test/mfi_recomputer-orin-nano-4g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nano-reserver-4g:
    stage: orin-nano-reserver-4g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nano-industrial-4g]



    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - cp extra_kernel_modules/lan743x.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/ethernet/microchip/lan743x.ko
         - cp extra_kernel_modules/spi-tegra114.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/spi/spi-tegra114.ko
         - cp extra_kernel_modules/8723du.ko rootfs/lib/modules/5.10.104-tegra/kernel/drivers/net/wireless/realtek/rtl8xxxu/8723du.ko
         - cp extra_kernel_modules/tpm/ rootfs/lib/modules/5.10.104-tegra/kernel/drivers/char/ -rf
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2   ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nano-4g-industrial-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2   ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  reserver-orin-industrial external 
         - cp  mfi_reserver-orin-industrial..tar.gz  deploy/test/mfi_reserver-orin-nano-4g-industrial-qspiflash-$DATE_STR.tar.gz 
         - umount deploy

job-orin-nano-devkit-4g:
    stage: orin-nano-devkit-4g
    when: on_success
    tags:
      - arm64-shell
    variables:
      USER: root
    needs: [job-orin-nano-reserver-4g]


    script:
         - id
         - wget  http://192.168.1.77/jetson/Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -q
         - tar xpf Tegra_Linux_Sample-Root-Filesystem_R35.3.1_aarch64.tbz2 -C rootfs
         - ./apply_binaries.sh
         - ./tools/l4t_flash_prerequisites.sh
         - sed -i "s/<SOC>/t234/g" rootfs/etc/apt/sources.list.d/nvidia-l4t-apt-source.list
         - mount --bind /sys ./rootfs/sys
         - mount --bind /dev ./rootfs/dev
         - mount --bind /dev/pts ./rootfs/dev/pts
         - mount --bind /proc ./rootfs/proc
         - cp /usr/bin/qemu-aarch64-static rootfs/usr/bin/
         - cp extra_scripts/rootfs_magic.sh rootfs
         - chroot rootfs /rootfs_magic.sh
         - umount ./rootfs/sys
         - umount ./rootfs/dev/pts
         - umount ./rootfs/dev
         - umount ./rootfs/proc
         - rm rootfs/rootfs_magic.sh
         - rm rootfs/usr/bin/qemu-aarch64-static
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2   ./tools/kernel_flash/l4t_initrd_flash.sh --external-device nvme0n1p1 -c tools/kernel_flash/flash_l4t_nvme.xml -S 80GiB  -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recomputer-orin  external 
         - mkdir deploy
         - mount -t cifs -o username=$SMB_USER,password=$SMB_PWD,vers=3.0,uid=1000,gid=1000,rw,file_mode=0664 //192.168.1.77/red_2t/jetson deploy
         - export DATE_STR=$(TZ='Asia/Hong_Kong' date +%Y-%m-%d)
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nano-4g-devkit-$DATE_STR.tar.gz 
         - BOARDID=3767 BOARDSKU=0004 FAB=300  BOARDREV=N.2   ./tools/kernel_flash/l4t_initrd_flash.sh   -p "-c bootloader/t186ref/cfg/flash_t234_qspi.xml --no-systemimg" --no-flash  --massflash 5  --network usb0  recompter-orin external 
         - cp  mfi_recomputer-orin.tar.gz  deploy/test/mfi_recomputer-orin-nano-4g-devkit-qspiflash-$DATE_STR.tar.gz 
         - umount deploy