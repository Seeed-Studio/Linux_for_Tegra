From 157c15d04cda66cccdd10085a17a923bace31952 Mon Sep 17 00:00:00 2001
From: Ram Muthiah <rammuthiah@google.com>
Date: Fri, 31 Jan 2020 00:36:48 -0800
Subject: [PATCH 625/830] ANDROID: gki: Removed cf modules from gki_defconfig
X-NVConfidentiality: public

Bug: 139431025
Test: Treehugger
Change-Id: Ib1de19b851f8dc07f77e4b6ec5acf88b6051b070
Signed-off-by: Ram Muthiah <rammuthiah@google.com>
---
 arch/arm64/configs/gki_defconfig | 21 ---------------------
 arch/x86/configs/gki_defconfig   | 23 -----------------------
 build.config.cuttlefish.aarch64  |  1 +
 build.config.cuttlefish.x86_64   |  1 +
 build.config.gki                 |  1 -
 cuttlefish.fragment              |  4 +---
 6 files changed, 3 insertions(+), 48 deletions(-)

diff --git a/arch/arm64/configs/gki_defconfig b/arch/arm64/configs/gki_defconfig
index 0601d0bd72aa..4036858f3faa 100644
--- a/arch/arm64/configs/gki_defconfig
+++ b/arch/arm64/configs/gki_defconfig
@@ -65,7 +65,6 @@ CONFIG_CPU_FREQ_TIMES=y
 CONFIG_CPU_FREQ_DEFAULT_GOV_SCHEDUTIL=y
 CONFIG_CPU_FREQ_GOV_POWERSAVE=y
 CONFIG_CPU_FREQ_GOV_CONSERVATIVE=y
-CONFIG_CPUFREQ_DUMMY=m
 CONFIG_ARM_SCPI_CPUFREQ=y
 CONFIG_ARM_SCMI_CPUFREQ=y
 CONFIG_ARM_SCMI_PROTOCOL=y
@@ -82,7 +81,6 @@ CONFIG_MODULE_UNLOAD=y
 CONFIG_MODVERSIONS=y
 CONFIG_GKI_HACKS_TO_FIX=y
 # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
-CONFIG_BINFMT_MISC=m
 CONFIG_MEMORY_HOTPLUG=y
 CONFIG_CMA=y
 CONFIG_CMA_AREAS=16
@@ -193,11 +191,7 @@ CONFIG_NET_CLS_BPF=y
 CONFIG_NET_EMATCH=y
 CONFIG_NET_EMATCH_U32=y
 CONFIG_NET_CLS_ACT=y
-CONFIG_VSOCKETS=m
-CONFIG_VIRTIO_VSOCKETS=m
 CONFIG_BPF_JIT=y
-CONFIG_CAN=m
-CONFIG_CAN_VCAN=m
 CONFIG_BT=y
 CONFIG_CFG80211=y
 # CONFIG_CFG80211_DEFAULT_PS is not set
@@ -216,12 +210,10 @@ CONFIG_FW_LOADER_USER_HELPER_FALLBACK=y
 # CONFIG_ALLOW_DEV_COREDUMP is not set
 CONFIG_DEBUG_DEVRES=y
 CONFIG_GNSS=y
-CONFIG_GNSS_CMDLINE_SERIAL=m
 CONFIG_ZRAM=y
 CONFIG_BLK_DEV_LOOP=y
 CONFIG_BLK_DEV_RAM=y
 CONFIG_BLK_DEV_RAM_SIZE=8192
-CONFIG_VIRTIO_BLK=m
 CONFIG_UID_SYS_STATS=y
 CONFIG_SCSI=y
 # CONFIG_SCSI_PROC_FS is not set
@@ -240,7 +232,6 @@ CONFIG_DM_BOW=y
 CONFIG_NETDEVICES=y
 CONFIG_DUMMY=y
 CONFIG_TUN=y
-CONFIG_VIRTIO_NET=m
 # CONFIG_ETHERNET is not set
 CONFIG_PHYLIB=y
 CONFIG_PPP=y
@@ -274,7 +265,6 @@ CONFIG_USB_USBNET=y
 # CONFIG_WLAN_VENDOR_TI is not set
 # CONFIG_WLAN_VENDOR_ZYDAS is not set
 # CONFIG_WLAN_VENDOR_QUANTENNA is not set
-CONFIG_VIRT_WIFI=m
 CONFIG_INPUT_EVDEV=y
 CONFIG_KEYBOARD_GPIO=y
 # CONFIG_INPUT_MOUSE is not set
@@ -292,9 +282,7 @@ CONFIG_SERIAL_OF_PLATFORM=y
 CONFIG_SERIAL_AMBA_PL011=y
 CONFIG_SERIAL_AMBA_PL011_CONSOLE=y
 CONFIG_SERIAL_DEV_BUS=y
-CONFIG_VIRTIO_CONSOLE=m
 CONFIG_HW_RANDOM=y
-CONFIG_HW_RANDOM_VIRTIO=m
 # CONFIG_HW_RANDOM_CAVIUM is not set
 # CONFIG_DEVPORT is not set
 # CONFIG_I2C_COMPAT is not set
@@ -319,7 +307,6 @@ CONFIG_MEDIA_CONTROLLER=y
 # CONFIG_VGA_ARB is not set
 CONFIG_DRM=y
 # CONFIG_DRM_FBDEV_EMULATION is not set
-CONFIG_DRM_VIRTIO_GPU=m
 CONFIG_BACKLIGHT_CLASS_DEVICE=y
 CONFIG_SOUND=y
 CONFIG_SND=y
@@ -343,7 +330,6 @@ CONFIG_USB_HIDDEV=y
 CONFIG_USB=y
 CONFIG_USB_OTG=y
 CONFIG_USB_GADGET=y
-CONFIG_USB_DUMMY_HCD=m
 CONFIG_USB_CONFIGFS=y
 CONFIG_USB_CONFIGFS_UEVENT=y
 CONFIG_USB_CONFIGFS_F_FS=y
@@ -361,17 +347,10 @@ CONFIG_LEDS_TRIGGERS=y
 CONFIG_EDAC=y
 CONFIG_RTC_CLASS=y
 # CONFIG_RTC_SYSTOHC is not set
-CONFIG_RTC_DRV_TEST=m
 CONFIG_RTC_DRV_PL030=y
 CONFIG_RTC_DRV_PL031=y
 CONFIG_DMADEVICES=y
 CONFIG_UIO=y
-CONFIG_VIRTIO_PCI=m
-# CONFIG_VIRTIO_PCI_LEGACY is not set
-CONFIG_VIRTIO_PMEM=m
-CONFIG_VIRTIO_INPUT=m
-CONFIG_VIRTIO_MMIO=m
-CONFIG_VIRTIO_MMIO_CMDLINE_DEVICES=y
 CONFIG_STAGING=y
 CONFIG_ASHMEM=y
 CONFIG_ANDROID_VSOC=y
diff --git a/arch/x86/configs/gki_defconfig b/arch/x86/configs/gki_defconfig
index 8c20e380d551..881b44ccc760 100644
--- a/arch/x86/configs/gki_defconfig
+++ b/arch/x86/configs/gki_defconfig
@@ -52,7 +52,6 @@ CONFIG_CPU_FREQ_TIMES=y
 CONFIG_CPU_FREQ_DEFAULT_GOV_SCHEDUTIL=y
 CONFIG_CPU_FREQ_GOV_POWERSAVE=y
 CONFIG_CPU_FREQ_GOV_CONSERVATIVE=y
-CONFIG_CPUFREQ_DUMMY=m
 CONFIG_IA32_EMULATION=y
 CONFIG_KPROBES=y
 CONFIG_MODULES=y
@@ -60,7 +59,6 @@ CONFIG_MODULE_UNLOAD=y
 CONFIG_MODVERSIONS=y
 CONFIG_GKI_HACKS_TO_FIX=y
 # CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
-CONFIG_BINFMT_MISC=m
 CONFIG_CMA=y
 CONFIG_CMA_AREAS=16
 CONFIG_ZSMALLOC=y
@@ -168,13 +166,7 @@ CONFIG_NET_CLS_BPF=y
 CONFIG_NET_EMATCH=y
 CONFIG_NET_EMATCH_U32=y
 CONFIG_NET_CLS_ACT=y
-CONFIG_VSOCKETS=m
-CONFIG_VIRTIO_VSOCKETS=m
 CONFIG_BPF_JIT=y
-CONFIG_CAN=m
-# CONFIG_CAN_BCM is not set
-# CONFIG_CAN_GW is not set
-CONFIG_CAN_VCAN=m
 CONFIG_CFG80211=y
 # CONFIG_CFG80211_DEFAULT_PS is not set
 # CONFIG_CFG80211_CRDA_SUPPORT is not set
@@ -189,13 +181,11 @@ CONFIG_FW_LOADER_USER_HELPER_FALLBACK=y
 # CONFIG_ALLOW_DEV_COREDUMP is not set
 CONFIG_DEBUG_DEVRES=y
 CONFIG_GNSS=y
-CONFIG_GNSS_CMDLINE_SERIAL=m
 CONFIG_OF=y
 CONFIG_ZRAM=y
 CONFIG_BLK_DEV_LOOP=y
 CONFIG_BLK_DEV_RAM=y
 CONFIG_BLK_DEV_RAM_SIZE=8192
-CONFIG_VIRTIO_BLK=m
 CONFIG_UID_SYS_STATS=y
 CONFIG_SCSI=y
 # CONFIG_SCSI_PROC_FS is not set
@@ -212,7 +202,6 @@ CONFIG_DM_BOW=y
 CONFIG_NETDEVICES=y
 CONFIG_DUMMY=y
 CONFIG_TUN=y
-CONFIG_VIRTIO_NET=m
 # CONFIG_ETHERNET is not set
 CONFIG_PHYLIB=y
 CONFIG_PPP=y
@@ -246,7 +235,6 @@ CONFIG_USB_USBNET=y
 # CONFIG_WLAN_VENDOR_TI is not set
 # CONFIG_WLAN_VENDOR_ZYDAS is not set
 # CONFIG_WLAN_VENDOR_QUANTENNA is not set
-CONFIG_VIRT_WIFI=m
 CONFIG_INPUT_EVDEV=y
 CONFIG_KEYBOARD_GPIO=y
 # CONFIG_INPUT_MOUSE is not set
@@ -261,9 +249,7 @@ CONFIG_SERIAL_8250=y
 CONFIG_SERIAL_8250_CONSOLE=y
 CONFIG_SERIAL_OF_PLATFORM=y
 CONFIG_SERIAL_DEV_BUS=y
-CONFIG_VIRTIO_CONSOLE=m
 CONFIG_HW_RANDOM=y
-CONFIG_HW_RANDOM_VIRTIO=m
 # CONFIG_I2C_COMPAT is not set
 # CONFIG_I2C_HELPER_AUTO is not set
 CONFIG_SPI=y
@@ -276,7 +262,6 @@ CONFIG_REGULATOR_FIXED_VOLTAGE=y
 CONFIG_MEDIA_CAMERA_SUPPORT=y
 CONFIG_DRM=y
 # CONFIG_DRM_FBDEV_EMULATION is not set
-CONFIG_DRM_VIRTIO_GPU=m
 CONFIG_BACKLIGHT_CLASS_DEVICE=y
 CONFIG_SOUND=y
 CONFIG_SND=y
@@ -285,7 +270,6 @@ CONFIG_SND_DYNAMIC_MINORS=y
 # CONFIG_SND_SUPPORT_OLD_API is not set
 # CONFIG_SND_VERBOSE_PROCFS is not set
 # CONFIG_SND_DRIVERS is not set
-CONFIG_SND_INTEL8X0=m
 # CONFIG_SND_USB is not set
 CONFIG_HIDRAW=y
 CONFIG_UHID=y
@@ -299,7 +283,6 @@ CONFIG_HID_SONY=y
 CONFIG_USB_HIDDEV=y
 CONFIG_USB=y
 CONFIG_USB_GADGET=y
-CONFIG_USB_DUMMY_HCD=m
 CONFIG_USB_CONFIGFS=y
 CONFIG_USB_CONFIGFS_UEVENT=y
 CONFIG_USB_CONFIGFS_F_FS=y
@@ -316,13 +299,7 @@ CONFIG_LEDS_CLASS=y
 CONFIG_LEDS_TRIGGERS=y
 CONFIG_RTC_CLASS=y
 # CONFIG_RTC_SYSTOHC is not set
-CONFIG_RTC_DRV_TEST=m
 CONFIG_UIO=y
-CONFIG_VIRTIO_PCI=m
-CONFIG_VIRTIO_PMEM=m
-CONFIG_VIRTIO_INPUT=m
-CONFIG_VIRTIO_MMIO=m
-CONFIG_VIRTIO_MMIO_CMDLINE_DEVICES=y
 CONFIG_STAGING=y
 CONFIG_ASHMEM=y
 CONFIG_ION=y
diff --git a/build.config.cuttlefish.aarch64 b/build.config.cuttlefish.aarch64
index 9450cead4b8e..e170d360c490 100644
--- a/build.config.cuttlefish.aarch64
+++ b/build.config.cuttlefish.aarch64
@@ -2,6 +2,7 @@
 . ${ROOT_DIR}/common/build.config.aarch64
 . ${ROOT_DIR}/common/build.config.gki
 
+BUILD_INITRAMFS=1
 DEFCONFIG=cf_aarch_64_gki_defconfig
 PRE_DEFCONFIG_CMDS="cat ./common/arch/arm64/configs/gki_defconfig ./common/cuttlefish.fragment > ./common/arch/arm64/configs/${DEFCONFIG};"
 POST_DEFCONFIG_CMDS="rm ./common/arch/arm64/configs/${DEFCONFIG}"
diff --git a/build.config.cuttlefish.x86_64 b/build.config.cuttlefish.x86_64
index 0778c5762b16..ccad66ebef5a 100644
--- a/build.config.cuttlefish.x86_64
+++ b/build.config.cuttlefish.x86_64
@@ -2,6 +2,7 @@
 . ${ROOT_DIR}/common/build.config.x86_64
 . ${ROOT_DIR}/common/build.config.gki
 
+BUILD_INITRAMFS=1
 DEFCONFIG=cf_x86_64_gki_defconfig
 PRE_DEFCONFIG_CMDS="cat ./common/arch/x86/configs/gki_defconfig ./common/cuttlefish.fragment > ./common/arch/x86/configs/${DEFCONFIG};"
 POST_DEFCONFIG_CMDS="rm ./common/arch/x86/configs/${DEFCONFIG}"
diff --git a/build.config.gki b/build.config.gki
index 66f6eb8baadb..44d4ed1bee1f 100644
--- a/build.config.gki
+++ b/build.config.gki
@@ -1,4 +1,3 @@
 DEFCONFIG=gki_defconfig
 POST_DEFCONFIG_CMDS="check_defconfig"
-BUILD_INITRAMFS=1
 
diff --git a/cuttlefish.fragment b/cuttlefish.fragment
index 5a2e559fc745..dbcc37000f3e 100644
--- a/cuttlefish.fragment
+++ b/cuttlefish.fragment
@@ -2,13 +2,10 @@ CONFIG_CPUFREQ_DUMMY=m
 CONFIG_BINFMT_MISC=m
 CONFIG_VSOCKETS=m
 CONFIG_VIRTIO_VSOCKETS=m
-CONFIG_CAN=m
-CONFIG_CAN_VCAN=m
 CONFIG_GNSS_CMDLINE_SERIAL=m
 CONFIG_VIRTIO_BLK=m
 CONFIG_VIRTIO_NET=m
 CONFIG_VIRT_WIFI=m
-CONFIG_VIRTIO_CONSOLE=m
 CONFIG_HW_RANDOM_VIRTIO=m
 CONFIG_DRM_VIRTIO_GPU=m
 CONFIG_SND_INTEL8X0=m
@@ -18,3 +15,4 @@ CONFIG_VIRTIO_PCI=m
 CONFIG_VIRTIO_PMEM=m
 CONFIG_VIRTIO_INPUT=m
 CONFIG_VIRTIO_MMIO=m
+CONFIG_VIRTIO_MMIO_CMDLINE_DEVICES=y
-- 
2.17.1

